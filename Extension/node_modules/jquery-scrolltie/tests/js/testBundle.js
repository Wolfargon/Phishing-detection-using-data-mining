(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/*-------------------------------------------- */
/** Helper to extract real values from         */
/** 2d Transform Matrix */
/*-------------------------------------------- */

module.exports = function(el) {
    var styles = window.getComputedStyle(el, null);

    if (!el || !styles) return;

    var matrixString = styles.getPropertyValue('-webkit-transform') ||
                       styles.getPropertyValue('-moz-transform') ||
                       styles.getPropertyValue('-ms-transform') ||
                       styles.getPropertyValue('-o-transform') ||
                       styles.getPropertyValue('transform');

    var matrixValues = matrixString.replace(/[matrix\(\)]/g, '').split(',');

    var a = matrixValues[0],
        b = matrixValues[1],
        c = matrixValues[2],
        d = matrixValues[3],
        xTranslate = matrixValues[4],
        yTranslate = matrixValues[5];

    var scale = Math.sqrt(a*a + b*b),
        sin = b/scale;

    var rotation = Math.round(Math.atan2(b, a) * (180/Math.PI));

    return {
        rotate: parseInt(rotation),
        scale: scale,
        translateX: parseInt(xTranslate),
        translateY: parseInt(yTranslate)
    };
};
},{}],2:[function(require,module,exports){
mocha.checkLeaks();
mocha.globals(['jQuery*', 'requestAnimationFrame', 'sinon']);

if (!window.__karma__) {
  mocha.run();
}

},{}],3:[function(require,module,exports){
mocha.setup('bdd');
expect = chai.expect;
assert = chai.assert;

},{}],4:[function(require,module,exports){
var $doc = $(document),
    parse2dTransformMatrix = require('../../../src/helpers/parse2dTransformMatrix');

/*-------------------------------------------- */
/** Set up little debounce to                  */
/** listen for scrollend
/*-------------------------------------------- */

var timeoutDelay = 40,
    scrollTicker = 0;

function detectScrollStop(ticker) {

    // debounce until scroll is over
    setTimeout(function(){
        if (ticker == scrollTicker) {
            $(document).trigger('scrollend');
        }
    }, timeoutDelay);
}

$(window).on('scroll', function() {
    scrollTicker++;
    detectScrollStop(scrollTicker);
});

/*-------------------------------------------- */
/** Actual Test */
/*-------------------------------------------- */

describe('ScrollTie', function() {
    var element;

    before(function() {
        $('body').css('height', 4000);
    })

    after(function() {
        $('body').css('height', 'auto');
    })

    beforeEach(function(done) {
        element = document.createElement('div');
        $('body').append(element);
        $(element).css({position: 'fixed', top: '0px'});
        done();
    })

    afterEach(function(done) {
        $(element).remove();
        done();
    })

    describe('$(element).scrollTie()', function() {
        it('should return a jQuery error', function() {
            var fn = $(document.createElement('div')).scrollTie;
            expect(fn).to.throw($.Error);
        })
    })

    describe('$(element).scrollTie(options)', function() {

        it('should add scrollTie instance to allScrollTiedElements', function() {
            $(element).scrollTie({ property: 'top' });
            expect($.scrollTie().indexOf($.data(element, 'plugin_scrollTie'))).to.not.equal(-1);
        })

        describe('property (special cases)', function() {

            it('should handle a transform shorthand', function(done) {
                $(element).scrollTie({ property: 'translateX' });

                $doc.one('scrollend', function() {
                    expect(parse2dTransformMatrix(element).translateX).to.equal(500);
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 500);
            })

            it('should handle a backgroundPosition axis', function(done) {
                $(element).scrollTie({ property: 'backgroundPositionX', speed: 1 });

                $doc.one('scrollend', function() {
                    expect(getComputedStyle(element).backgroundPosition.split(' ')[0]).to.equal('500px');
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 500);
            })

        })

        describe('stopAtValue option', function() {

            it('should increment property to stopAtValue', function(done) {
                $(element).scrollTie({ property: 'top', stopAtValue: 500 });

                $doc.one('scrollend', function() {
                    expect(element.style.top).to.equal('500px');
                    done();
                });

                window.scrollTo(0, 500);
            })

            it('should not increment property higher than stopAtValue', function(done) {
                $(element).scrollTie({ property: 'top', stopAtValue: 500 });

                $doc.one('scrollend', function() {
                    expect(element.style.top).to.equal('500px');
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 501);
            })

        })

        describe('reverseDirection option', function() {

            it('should decrement position', function(done) {
                $(element).css({top: '500px'});
                $(element).scrollTie({ property: 'top', reverseDirection: true });

                $doc.one('scrollend', function() {
                    expect(element.style.top).to.equal('0px');
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 500);
            })

        })

        describe('delay option', function() {

            it('should not increment property when scroll is less than delay (px value)', function(done) {
                $(element).scrollTie({ property: 'top', delay: 500 });

                $doc.one('scrollend', function() {
                    expect(element.style.top).to.equal('0px');
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 500);
            })

            it('should not increment property when scroll is less than delay (function return value)', function(done) {
                $(element).scrollTie({ property: 'top', delay: function(el) {
                    return 500;
                } });

                $doc.one('scrollend', function() {
                    expect(element.style.top).to.equal('0px');
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 500);
            })

            it('should begin incrementing property when scroll position is greater than delay', function(done) {
                $(element).scrollTie({ property: 'top', delay: 500});
                $(element).css({position: 'absolute'});

                $doc.one('scrollend', function() {
                    expect(element.style.top).to.equal('1px');
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 501);
            })

        })

        describe('speed option', function() {

            it('should increment position at correct speed', function(done) {
                $(element).scrollTie({ property: 'top', speed: 2 });
                $(element).css({position: 'absolute'});

                $doc.one('scrollend', function() {
                    expect(element.style.top).to.equal('1000px');
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 500);
            })

        })

        describe('animateWhenOutOfView option', function() {

            beforeEach(function(done) {
                $(element).css({ position: 'absolute', left: '30px', height: '100px', width: '100px'});
                done();
            })

            describe('default: false', function() {

                it('should increment value while element is in view', function(done) {
                    $(element).scrollTie({ property: 'left' });

                    $doc.one('scrollend', function() {
                        expect(element.style.left).to.equal('229px');
                        done();
                    });

                    window.scrollTo(0, 199);
                })

                it('should return to original value when element is no longer in view, with buffer of 100px', function(done) {
                    $(element).scrollTie({ property: 'left' });

                    $doc.one('scrollend', function() {
                        expect(element.style.left).to.equal('30px');
                        done();
                        window.scrollTo(0, 0);
                    });

                    window.scrollTo(0, 300);
                })

            })

            describe('true', function() {

                beforeEach(function(done) {
                    $(element).css({ position: 'absolute', left: '30px', height: '100px', width: '100px'});
                    done();
                })

                it('should continue incrementing value when element is no longer in view', function(done) {
                    $(element).scrollTie({ property: 'left', animateWhenOutOfView: true });

                    $doc.one('scrollend', function() {
                        expect(element.style.left).to.equal('330px');
                        done();
                        window.scrollTo(0, 0);
                    });

                    window.scrollTo(0, 300);
                })

            })

        })

        describe('onStart callback option', function() {
            var onStart = sinon.spy();

            it('should call onStart once after first animation frame', function(done) {
                $(element).scrollTie({ property: 'top', onStart: onStart });

                $doc.one('scrollend', function() {
                    expect(onStart.calledOnce).to.be.true();
                    done();
                });

                window.scrollTo(0, 500);
            })

            it('should not call onStart on subsequent scrolls', function(done) {

                $doc.one('scrollend', function() {
                    expect(onStart.callCount).to.equal(1);
                    done();
                    window.scrollTo(0, 0);
                });

                window.scrollTo(0, 501);
            })

        })

        describe('afterStop callback option', function() {
            var afterStop = sinon.spy();

            describe('should call afterStop each time stopAtValue is reached', function() {

                it('calls afterStop when stopAtValue is reached', function(done) {
                    $(element).scrollTie({ property: 'top', afterStop: afterStop, stopAtValue: 500 });

                    $doc.one('scrollend', function() {
                        expect(afterStop.callCount).to.equal(1);
                        done();
                        window.scrollTo(0, 0);
                    });

                    window.scrollTo(0, 500);
                })

                it('calls afterStop if stopAtValue is reached again', function(done) {

                    $doc.one('scrollend', function() {
                        expect(afterStop.callCount).to.equal(2);
                        done();
                        window.scrollTo(0, 0);
                    });
                    
                    window.scrollTo(0, 500);
                })
            })

        })

        describe('onPause callback option', function() {
            var onPause = sinon.spy();

            describe('should call onPause when scrollTied element is manually paused', function() {

                it('calls onPause when pause() is called on scrollTied element', function(done) {
                    $(element).scrollTie({ property: 'top', onPause: onPause });

                    $(element).scrollTie('pause');

                    $doc.one('scrollend', function() {
                        expect(onPause.callCount).to.equal(1);
                        done();
                    });
                })
            })

        })

        describe('onDestroy callback option', function() {
            var onDestroy = sinon.spy();

            describe('should call onDestroy when scrollTied element is manually destroyed', function() {

                it('calls onDestroy when destroy() is called on scrollTied element', function() {
                    $(element).scrollTie({ property: 'top', onDestroy: onDestroy });

                    $(element).scrollTie('destroy');

                    expect(onDestroy.callCount).to.equal(1);
                })
            })

        })

    })

    describe('scrollTie#pause and scrollTie#restart', function() {
        var $el;

        before(function(done) {
            $el = $(element);
            $el.scrollTie({ property: 'top' });
            done();
        })

        it('should stop updating property on scroll while paused', function(done) {
            $el.scrollTie('pause');

            $doc.one('scrollend', function() {
                expect($el.css('top')).to.equal('0px');
                done();
            });

            window.scrollTo(0, 500);
        })

        it('should start updating property on scroll starting from last pause value', function(done) {
            $el.scrollTie('restart');

            $doc.one('scrollend', function() {
                expect($el.css('top')).to.equal('100px');
                done();
                window.scrollTo(0, 0);
            });

            window.scrollTo(0, 600);
        })

    })

    describe('scrollTie#destroy', function() {
        var $el,
            scrollTieInstance;

        it('should remove instance from allScrollTiedElements', function() {
            $el = $(element);
            $el.scrollTie({ property: 'top' });

            scrollTieInstance = $el.data().plugin_scrollTie;

            $el.scrollTie('destroy');

            expect($.scrollTie().indexOf(scrollTieInstance)).to.equal(-1);
        })

        it('should no longer update property', function(done) {

            $doc.one('scrollend', function() {
                expect($el[0].style.top).to.be.empty();
                done();
            });

            window.scrollTo(0, 300);
        })

        it('should remove plugin data from jQuery object', function() {
            expect($el.data().plugin_scrollTie).to.be.undefined;
        })

        it('should not have access to public instance methods', function() {
            var fn = $(element).scrollTie.bind($(this).data().plugin_scrollTie, 'pause');
            expect(fn).to.throw($.Error);
        })
    })

    // methods left to test:
    // 1. refresh
    // 2. Special props: transforms and bgPos

});

},{"../../../src/helpers/parse2dTransformMatrix":1}]},{},[3,4,2])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9ncnVudC1icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvaGVscGVycy9wYXJzZTJkVHJhbnNmb3JtTWF0cml4LmpzIiwidGVzdHMvanMvcnVubmVyLmpzIiwidGVzdHMvanMvc2V0dXAuanMiLCJ0ZXN0cy9qcy9zcmMvc2Nyb2xsVGllLXRlc3RzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ05BO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4vKiogSGVscGVyIHRvIGV4dHJhY3QgcmVhbCB2YWx1ZXMgZnJvbSAgICAgICAgICovXG4vKiogMmQgVHJhbnNmb3JtIE1hdHJpeCAqL1xuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgdmFyIHN0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsLCBudWxsKTtcblxuICAgIGlmICghZWwgfHwgIXN0eWxlcykgcmV0dXJuO1xuXG4gICAgdmFyIG1hdHJpeFN0cmluZyA9IHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCctd2Via2l0LXRyYW5zZm9ybScpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCctbW96LXRyYW5zZm9ybScpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCctbXMtdHJhbnNmb3JtJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzLmdldFByb3BlcnR5VmFsdWUoJy1vLXRyYW5zZm9ybScpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCd0cmFuc2Zvcm0nKTtcblxuICAgIHZhciBtYXRyaXhWYWx1ZXMgPSBtYXRyaXhTdHJpbmcucmVwbGFjZSgvW21hdHJpeFxcKFxcKV0vZywgJycpLnNwbGl0KCcsJyk7XG5cbiAgICB2YXIgYSA9IG1hdHJpeFZhbHVlc1swXSxcbiAgICAgICAgYiA9IG1hdHJpeFZhbHVlc1sxXSxcbiAgICAgICAgYyA9IG1hdHJpeFZhbHVlc1syXSxcbiAgICAgICAgZCA9IG1hdHJpeFZhbHVlc1szXSxcbiAgICAgICAgeFRyYW5zbGF0ZSA9IG1hdHJpeFZhbHVlc1s0XSxcbiAgICAgICAgeVRyYW5zbGF0ZSA9IG1hdHJpeFZhbHVlc1s1XTtcblxuICAgIHZhciBzY2FsZSA9IE1hdGguc3FydChhKmEgKyBiKmIpLFxuICAgICAgICBzaW4gPSBiL3NjYWxlO1xuXG4gICAgdmFyIHJvdGF0aW9uID0gTWF0aC5yb3VuZChNYXRoLmF0YW4yKGIsIGEpICogKDE4MC9NYXRoLlBJKSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByb3RhdGU6IHBhcnNlSW50KHJvdGF0aW9uKSxcbiAgICAgICAgc2NhbGU6IHNjYWxlLFxuICAgICAgICB0cmFuc2xhdGVYOiBwYXJzZUludCh4VHJhbnNsYXRlKSxcbiAgICAgICAgdHJhbnNsYXRlWTogcGFyc2VJbnQoeVRyYW5zbGF0ZSlcbiAgICB9O1xufTsiLCJtb2NoYS5jaGVja0xlYWtzKCk7XG5tb2NoYS5nbG9iYWxzKFsnalF1ZXJ5KicsICdyZXF1ZXN0QW5pbWF0aW9uRnJhbWUnLCAnc2lub24nXSk7XG5cbmlmICghd2luZG93Ll9fa2FybWFfXykge1xuICBtb2NoYS5ydW4oKTtcbn1cbiIsIm1vY2hhLnNldHVwKCdiZGQnKTtcbmV4cGVjdCA9IGNoYWkuZXhwZWN0O1xuYXNzZXJ0ID0gY2hhaS5hc3NlcnQ7XG4iLCJ2YXIgJGRvYyA9ICQoZG9jdW1lbnQpLFxuICAgIHBhcnNlMmRUcmFuc2Zvcm1NYXRyaXggPSByZXF1aXJlKCcuLi8uLi8uLi9zcmMvaGVscGVycy9wYXJzZTJkVHJhbnNmb3JtTWF0cml4Jyk7XG5cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbi8qKiBTZXQgdXAgbGl0dGxlIGRlYm91bmNlIHRvICAgICAgICAgICAgICAgICAgKi9cbi8qKiBsaXN0ZW4gZm9yIHNjcm9sbGVuZFxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG52YXIgdGltZW91dERlbGF5ID0gNDAsXG4gICAgc2Nyb2xsVGlja2VyID0gMDtcblxuZnVuY3Rpb24gZGV0ZWN0U2Nyb2xsU3RvcCh0aWNrZXIpIHtcblxuICAgIC8vIGRlYm91bmNlIHVudGlsIHNjcm9sbCBpcyBvdmVyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICBpZiAodGlja2VyID09IHNjcm9sbFRpY2tlcikge1xuICAgICAgICAgICAgJChkb2N1bWVudCkudHJpZ2dlcignc2Nyb2xsZW5kJyk7XG4gICAgICAgIH1cbiAgICB9LCB0aW1lb3V0RGVsYXkpO1xufVxuXG4kKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgIHNjcm9sbFRpY2tlcisrO1xuICAgIGRldGVjdFNjcm9sbFN0b3Aoc2Nyb2xsVGlja2VyKTtcbn0pO1xuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovXG4vKiogQWN0dWFsIFRlc3QgKi9cbi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuZGVzY3JpYmUoJ1Njcm9sbFRpZScsIGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbGVtZW50O1xuXG4gICAgYmVmb3JlKGZ1bmN0aW9uKCkge1xuICAgICAgICAkKCdib2R5JykuY3NzKCdoZWlnaHQnLCA0MDAwKTtcbiAgICB9KVxuXG4gICAgYWZ0ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICQoJ2JvZHknKS5jc3MoJ2hlaWdodCcsICdhdXRvJyk7XG4gICAgfSlcblxuICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICQoJ2JvZHknKS5hcHBlbmQoZWxlbWVudCk7XG4gICAgICAgICQoZWxlbWVudCkuY3NzKHtwb3NpdGlvbjogJ2ZpeGVkJywgdG9wOiAnMHB4J30pO1xuICAgICAgICBkb25lKCk7XG4gICAgfSlcblxuICAgIGFmdGVyRWFjaChmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICQoZWxlbWVudCkucmVtb3ZlKCk7XG4gICAgICAgIGRvbmUoKTtcbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJyQoZWxlbWVudCkuc2Nyb2xsVGllKCknLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBqUXVlcnkgZXJyb3InLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBmbiA9ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpLnNjcm9sbFRpZTtcbiAgICAgICAgICAgIGV4cGVjdChmbikudG8udGhyb3coJC5FcnJvcik7XG4gICAgICAgIH0pXG4gICAgfSlcblxuICAgIGRlc2NyaWJlKCckKGVsZW1lbnQpLnNjcm9sbFRpZShvcHRpb25zKScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGl0KCdzaG91bGQgYWRkIHNjcm9sbFRpZSBpbnN0YW5jZSB0byBhbGxTY3JvbGxUaWVkRWxlbWVudHMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoZWxlbWVudCkuc2Nyb2xsVGllKHsgcHJvcGVydHk6ICd0b3AnIH0pO1xuICAgICAgICAgICAgZXhwZWN0KCQuc2Nyb2xsVGllKCkuaW5kZXhPZigkLmRhdGEoZWxlbWVudCwgJ3BsdWdpbl9zY3JvbGxUaWUnKSkpLnRvLm5vdC5lcXVhbCgtMSk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ3Byb3BlcnR5IChzcGVjaWFsIGNhc2VzKScsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBhIHRyYW5zZm9ybSBzaG9ydGhhbmQnLCBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgICAgICAgJChlbGVtZW50KS5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ3RyYW5zbGF0ZVgnIH0pO1xuXG4gICAgICAgICAgICAgICAgJGRvYy5vbmUoJ3Njcm9sbGVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QocGFyc2UyZFRyYW5zZm9ybU1hdHJpeChlbGVtZW50KS50cmFuc2xhdGVYKS50by5lcXVhbCg1MDApO1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCA1MDApO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgYSBiYWNrZ3JvdW5kUG9zaXRpb24gYXhpcycsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAnYmFja2dyb3VuZFBvc2l0aW9uWCcsIHNwZWVkOiAxIH0pO1xuXG4gICAgICAgICAgICAgICAgJGRvYy5vbmUoJ3Njcm9sbGVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KS5iYWNrZ3JvdW5kUG9zaXRpb24uc3BsaXQoJyAnKVswXSkudG8uZXF1YWwoJzUwMHB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ3N0b3BBdFZhbHVlIG9wdGlvbicsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIGluY3JlbWVudCBwcm9wZXJ0eSB0byBzdG9wQXRWYWx1ZScsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAndG9wJywgc3RvcEF0VmFsdWU6IDUwMCB9KTtcblxuICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGVsZW1lbnQuc3R5bGUudG9wKS50by5lcXVhbCgnNTAwcHgnKTtcbiAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIG5vdCBpbmNyZW1lbnQgcHJvcGVydHkgaGlnaGVyIHRoYW4gc3RvcEF0VmFsdWUnLCBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgICAgICAgJChlbGVtZW50KS5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ3RvcCcsIHN0b3BBdFZhbHVlOiA1MDAgfSk7XG5cbiAgICAgICAgICAgICAgICAkZG9jLm9uZSgnc2Nyb2xsZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChlbGVtZW50LnN0eWxlLnRvcCkudG8uZXF1YWwoJzUwMHB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMSk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ3JldmVyc2VEaXJlY3Rpb24gb3B0aW9uJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgZGVjcmVtZW50IHBvc2l0aW9uJywgZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgICAgICAgICQoZWxlbWVudCkuY3NzKHt0b3A6ICc1MDBweCd9KTtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAndG9wJywgcmV2ZXJzZURpcmVjdGlvbjogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGVsZW1lbnQuc3R5bGUudG9wKS50by5lcXVhbCgnMHB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ2RlbGF5IG9wdGlvbicsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIG5vdCBpbmNyZW1lbnQgcHJvcGVydHkgd2hlbiBzY3JvbGwgaXMgbGVzcyB0aGFuIGRlbGF5IChweCB2YWx1ZSknLCBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgICAgICAgJChlbGVtZW50KS5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ3RvcCcsIGRlbGF5OiA1MDAgfSk7XG5cbiAgICAgICAgICAgICAgICAkZG9jLm9uZSgnc2Nyb2xsZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChlbGVtZW50LnN0eWxlLnRvcCkudG8uZXF1YWwoJzBweCcpO1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCA1MDApO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgaXQoJ3Nob3VsZCBub3QgaW5jcmVtZW50IHByb3BlcnR5IHdoZW4gc2Nyb2xsIGlzIGxlc3MgdGhhbiBkZWxheSAoZnVuY3Rpb24gcmV0dXJuIHZhbHVlKScsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAndG9wJywgZGVsYXk6IGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA1MDA7XG4gICAgICAgICAgICAgICAgfSB9KTtcblxuICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGVsZW1lbnQuc3R5bGUudG9wKS50by5lcXVhbCgnMHB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIGJlZ2luIGluY3JlbWVudGluZyBwcm9wZXJ0eSB3aGVuIHNjcm9sbCBwb3NpdGlvbiBpcyBncmVhdGVyIHRoYW4gZGVsYXknLCBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgICAgICAgJChlbGVtZW50KS5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ3RvcCcsIGRlbGF5OiA1MDB9KTtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmNzcyh7cG9zaXRpb246ICdhYnNvbHV0ZSd9KTtcblxuICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGVsZW1lbnQuc3R5bGUudG9wKS50by5lcXVhbCgnMXB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMSk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ3NwZWVkIG9wdGlvbicsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIGluY3JlbWVudCBwb3NpdGlvbiBhdCBjb3JyZWN0IHNwZWVkJywgZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgICAgICAgICQoZWxlbWVudCkuc2Nyb2xsVGllKHsgcHJvcGVydHk6ICd0b3AnLCBzcGVlZDogMiB9KTtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmNzcyh7cG9zaXRpb246ICdhYnNvbHV0ZSd9KTtcblxuICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGVsZW1lbnQuc3R5bGUudG9wKS50by5lcXVhbCgnMTAwMHB4Jyk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ2FuaW1hdGVXaGVuT3V0T2ZWaWV3IG9wdGlvbicsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmNzcyh7IHBvc2l0aW9uOiAnYWJzb2x1dGUnLCBsZWZ0OiAnMzBweCcsIGhlaWdodDogJzEwMHB4Jywgd2lkdGg6ICcxMDBweCd9KTtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBkZXNjcmliZSgnZGVmYXVsdDogZmFsc2UnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGl0KCdzaG91bGQgaW5jcmVtZW50IHZhbHVlIHdoaWxlIGVsZW1lbnQgaXMgaW4gdmlldycsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ2xlZnQnIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChlbGVtZW50LnN0eWxlLmxlZnQpLnRvLmVxdWFsKCcyMjlweCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMTk5KTtcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdG8gb3JpZ2luYWwgdmFsdWUgd2hlbiBlbGVtZW50IGlzIG5vIGxvbmdlciBpbiB2aWV3LCB3aXRoIGJ1ZmZlciBvZiAxMDBweCcsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ2xlZnQnIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChlbGVtZW50LnN0eWxlLmxlZnQpLnRvLmVxdWFsKCczMHB4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAzMDApO1xuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGRlc2NyaWJlKCd0cnVlJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5jc3MoeyBwb3NpdGlvbjogJ2Fic29sdXRlJywgbGVmdDogJzMwcHgnLCBoZWlnaHQ6ICcxMDBweCcsIHdpZHRoOiAnMTAwcHgnfSk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgaXQoJ3Nob3VsZCBjb250aW51ZSBpbmNyZW1lbnRpbmcgdmFsdWUgd2hlbiBlbGVtZW50IGlzIG5vIGxvbmdlciBpbiB2aWV3JywgZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAnbGVmdCcsIGFuaW1hdGVXaGVuT3V0T2ZWaWV3OiB0cnVlIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChlbGVtZW50LnN0eWxlLmxlZnQpLnRvLmVxdWFsKCczMzBweCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMzAwKTtcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ29uU3RhcnQgY2FsbGJhY2sgb3B0aW9uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgb25TdGFydCA9IHNpbm9uLnNweSgpO1xuXG4gICAgICAgICAgICBpdCgnc2hvdWxkIGNhbGwgb25TdGFydCBvbmNlIGFmdGVyIGZpcnN0IGFuaW1hdGlvbiBmcmFtZScsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAndG9wJywgb25TdGFydDogb25TdGFydCB9KTtcblxuICAgICAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KG9uU3RhcnQuY2FsbGVkT25jZSkudG8uYmUudHJ1ZSgpO1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgNTAwKTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGl0KCdzaG91bGQgbm90IGNhbGwgb25TdGFydCBvbiBzdWJzZXF1ZW50IHNjcm9sbHMnLCBmdW5jdGlvbihkb25lKSB7XG5cbiAgICAgICAgICAgICAgICAkZG9jLm9uZSgnc2Nyb2xsZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChvblN0YXJ0LmNhbGxDb3VudCkudG8uZXF1YWwoMSk7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDUwMSk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ2FmdGVyU3RvcCBjYWxsYmFjayBvcHRpb24nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBhZnRlclN0b3AgPSBzaW5vbi5zcHkoKTtcblxuICAgICAgICAgICAgZGVzY3JpYmUoJ3Nob3VsZCBjYWxsIGFmdGVyU3RvcCBlYWNoIHRpbWUgc3RvcEF0VmFsdWUgaXMgcmVhY2hlZCcsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgaXQoJ2NhbGxzIGFmdGVyU3RvcCB3aGVuIHN0b3BBdFZhbHVlIGlzIHJlYWNoZWQnLCBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkuc2Nyb2xsVGllKHsgcHJvcGVydHk6ICd0b3AnLCBhZnRlclN0b3A6IGFmdGVyU3RvcCwgc3RvcEF0VmFsdWU6IDUwMCB9KTtcblxuICAgICAgICAgICAgICAgICAgICAkZG9jLm9uZSgnc2Nyb2xsZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoYWZ0ZXJTdG9wLmNhbGxDb3VudCkudG8uZXF1YWwoMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCA1MDApO1xuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICBpdCgnY2FsbHMgYWZ0ZXJTdG9wIGlmIHN0b3BBdFZhbHVlIGlzIHJlYWNoZWQgYWdhaW4nLCBmdW5jdGlvbihkb25lKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJGRvYy5vbmUoJ3Njcm9sbGVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGFmdGVyU3RvcC5jYWxsQ291bnQpLnRvLmVxdWFsKDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCA1MDApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVzY3JpYmUoJ29uUGF1c2UgY2FsbGJhY2sgb3B0aW9uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgb25QYXVzZSA9IHNpbm9uLnNweSgpO1xuXG4gICAgICAgICAgICBkZXNjcmliZSgnc2hvdWxkIGNhbGwgb25QYXVzZSB3aGVuIHNjcm9sbFRpZWQgZWxlbWVudCBpcyBtYW51YWxseSBwYXVzZWQnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGl0KCdjYWxscyBvblBhdXNlIHdoZW4gcGF1c2UoKSBpcyBjYWxsZWQgb24gc2Nyb2xsVGllZCBlbGVtZW50JywgZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAndG9wJywgb25QYXVzZTogb25QYXVzZSB9KTtcblxuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLnNjcm9sbFRpZSgncGF1c2UnKTtcblxuICAgICAgICAgICAgICAgICAgICAkZG9jLm9uZSgnc2Nyb2xsZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3Qob25QYXVzZS5jYWxsQ291bnQpLnRvLmVxdWFsKDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcblxuICAgICAgICB9KVxuXG4gICAgICAgIGRlc2NyaWJlKCdvbkRlc3Ryb3kgY2FsbGJhY2sgb3B0aW9uJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgb25EZXN0cm95ID0gc2lub24uc3B5KCk7XG5cbiAgICAgICAgICAgIGRlc2NyaWJlKCdzaG91bGQgY2FsbCBvbkRlc3Ryb3kgd2hlbiBzY3JvbGxUaWVkIGVsZW1lbnQgaXMgbWFudWFsbHkgZGVzdHJveWVkJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBpdCgnY2FsbHMgb25EZXN0cm95IHdoZW4gZGVzdHJveSgpIGlzIGNhbGxlZCBvbiBzY3JvbGxUaWVkIGVsZW1lbnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ3RvcCcsIG9uRGVzdHJveTogb25EZXN0cm95IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkuc2Nyb2xsVGllKCdkZXN0cm95Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KG9uRGVzdHJveS5jYWxsQ291bnQpLnRvLmVxdWFsKDEpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG5cbiAgICB9KVxuXG4gICAgZGVzY3JpYmUoJ3Njcm9sbFRpZSNwYXVzZSBhbmQgc2Nyb2xsVGllI3Jlc3RhcnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICRlbDtcblxuICAgICAgICBiZWZvcmUoZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgICAgJGVsID0gJChlbGVtZW50KTtcbiAgICAgICAgICAgICRlbC5zY3JvbGxUaWUoeyBwcm9wZXJ0eTogJ3RvcCcgfSk7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgaXQoJ3Nob3VsZCBzdG9wIHVwZGF0aW5nIHByb3BlcnR5IG9uIHNjcm9sbCB3aGlsZSBwYXVzZWQnLCBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgICAkZWwuc2Nyb2xsVGllKCdwYXVzZScpO1xuXG4gICAgICAgICAgICAkZG9jLm9uZSgnc2Nyb2xsZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KCRlbC5jc3MoJ3RvcCcpKS50by5lcXVhbCgnMHB4Jyk7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCA1MDApO1xuICAgICAgICB9KVxuXG4gICAgICAgIGl0KCdzaG91bGQgc3RhcnQgdXBkYXRpbmcgcHJvcGVydHkgb24gc2Nyb2xsIHN0YXJ0aW5nIGZyb20gbGFzdCBwYXVzZSB2YWx1ZScsIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICAgICRlbC5zY3JvbGxUaWUoJ3Jlc3RhcnQnKTtcblxuICAgICAgICAgICAgJGRvYy5vbmUoJ3Njcm9sbGVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGV4cGVjdCgkZWwuY3NzKCd0b3AnKSkudG8uZXF1YWwoJzEwMHB4Jyk7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgNjAwKTtcbiAgICAgICAgfSlcblxuICAgIH0pXG5cbiAgICBkZXNjcmliZSgnc2Nyb2xsVGllI2Rlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICRlbCxcbiAgICAgICAgICAgIHNjcm9sbFRpZUluc3RhbmNlO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVtb3ZlIGluc3RhbmNlIGZyb20gYWxsU2Nyb2xsVGllZEVsZW1lbnRzJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkZWwgPSAkKGVsZW1lbnQpO1xuICAgICAgICAgICAgJGVsLnNjcm9sbFRpZSh7IHByb3BlcnR5OiAndG9wJyB9KTtcblxuICAgICAgICAgICAgc2Nyb2xsVGllSW5zdGFuY2UgPSAkZWwuZGF0YSgpLnBsdWdpbl9zY3JvbGxUaWU7XG5cbiAgICAgICAgICAgICRlbC5zY3JvbGxUaWUoJ2Rlc3Ryb3knKTtcblxuICAgICAgICAgICAgZXhwZWN0KCQuc2Nyb2xsVGllKCkuaW5kZXhPZihzY3JvbGxUaWVJbnN0YW5jZSkpLnRvLmVxdWFsKC0xKTtcbiAgICAgICAgfSlcblxuICAgICAgICBpdCgnc2hvdWxkIG5vIGxvbmdlciB1cGRhdGUgcHJvcGVydHknLCBmdW5jdGlvbihkb25lKSB7XG5cbiAgICAgICAgICAgICRkb2Mub25lKCdzY3JvbGxlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBleHBlY3QoJGVsWzBdLnN0eWxlLnRvcCkudG8uYmUuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDMwMCk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZW1vdmUgcGx1Z2luIGRhdGEgZnJvbSBqUXVlcnkgb2JqZWN0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBleHBlY3QoJGVsLmRhdGEoKS5wbHVnaW5fc2Nyb2xsVGllKS50by5iZS51bmRlZmluZWQ7XG4gICAgICAgIH0pXG5cbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgaGF2ZSBhY2Nlc3MgdG8gcHVibGljIGluc3RhbmNlIG1ldGhvZHMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBmbiA9ICQoZWxlbWVudCkuc2Nyb2xsVGllLmJpbmQoJCh0aGlzKS5kYXRhKCkucGx1Z2luX3Njcm9sbFRpZSwgJ3BhdXNlJyk7XG4gICAgICAgICAgICBleHBlY3QoZm4pLnRvLnRocm93KCQuRXJyb3IpO1xuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICAvLyBtZXRob2RzIGxlZnQgdG8gdGVzdDpcbiAgICAvLyAxLiByZWZyZXNoXG4gICAgLy8gMi4gU3BlY2lhbCBwcm9wczogdHJhbnNmb3JtcyBhbmQgYmdQb3NcblxufSk7XG4iXX0=
